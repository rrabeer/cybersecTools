# Search: Failed SSH by Source IP (last 60 minutes)
index=* sourcetype=linux_secure ("Failed password" OR "invalid user") "sshd"
| rex field=_raw "from\s+(?<src_ip>\d{1,3}(?:\.\d{1,3}){3})"
| stats count as failed_attempts, values(user) as users, earliest(_time) as first_seen, latest(_time) as last_seen by src_ip
| where failed_attempts >= 5
| eval first_seen=strftime(first_seen, "%Y-%m-%d %H:%M:%S"), last_seen=strftime(last_seen, "%Y-%m-%d %H:%M:%S")
| sort - failed_attempts
